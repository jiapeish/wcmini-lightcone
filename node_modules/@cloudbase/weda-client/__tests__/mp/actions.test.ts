import * as actions from '../../src/mp/actions';
import * as service from '../../src/common/models/request';

describe('test src/mp/actions.ts', () => {
  it('test scanCode', async () => {
    actions.scanCode({
      enableDefaultBehavior: true,
    });
    expect(wx.scanCode).toBeCalled();
  });
  it('test createMpActionsAPI hideLoading', () => {
    const initData = { appConfig: { staticResourceDomain: 'lowcode-9gu72kpiac8de2d6-1252394733.tcloudbaseapp.com' } };
    const res = actions.createMpActionsAPI(initData);
    res.hideLoading();
    expect(wx.hideLoading).toBeCalled();
  });
  it('test createMpActionsAPI showModal', () => {
    const initData = { appConfig: { staticResourceDomain: 'lowcode-9gu72kpiac8de2d6-1252394733.tcloudbaseapp.com' } };
    const res = actions.createMpActionsAPI(initData);
    res.showModal({});
    expect(wx.showModal).toBeCalled();
  });
  it('test createMpActionsAPI callProcess', () => {
    const initData = { appConfig: { staticResourceDomain: 'lowcode-9gu72kpiac8de2d6-1252394733.tcloudbaseapp.com' } };
    const res = actions.createMpActionsAPI(initData);
    jest.spyOn(service, 'callWedaApiFn').mockImplementation(async () => {
      return new Promise((resolve, reject) => {
        return resolve({});
      });
    });
    res.callProcess({
      processKey: 'xx',
      startParams: {
        fieldType: 'xx',
        name: 'xx',
        paramCode: 'xx',
        entityCode: 'xx',
        fieldValueMap: [],
      },
    } as any);
    expect(service.callWedaApiFn).toBeCalled();
  });
  it('test createMpActionsAPI callPhone', () => {
    const initData = { appConfig: { staticResourceDomain: 'lowcode-9gu72kpiac8de2d6-1252394733.tcloudbaseapp.com' } };
    const res = actions.createMpActionsAPI(initData);
    res.callPhone({
      tel: 'xx',
    } as any);
    expect(wx.makePhoneCall).toBeCalled();
  });
});
