
## 汇总api
- app：应用相关方法。文档[点击这里](https://docs.cloudbase.net/lowcode/framework/app/app)
- auth：权限、用户信息、应用信息、登入/登出等
具体API见如下。

## 初始化
### app.init(params: Object)
初始化。目前只支持web。
#### 入参 Object 属性
| 属性     | 类型     | 默认值   | 必填     | 说明     |
| -------- | --------- | --------   | -------- | -------- |
| type     | string     |               |  是       | portal:企业工作台|
| isProd  |  boolen    |               |  是       | 是否是正式环境 |
| envId   |  string    |               |  是       | 环境id |
| login    | function |               |  否       | 登录后的回调函数，调用auth.signIn后的执行回调函数，例如可跳转到登录页 |
#### 示例
```javascript
import { app } from '@cloudbase/weda-client';
// 1、初始化工作台
app.init({
	type: 'portal',
	isProd: true,
	envId: '你的环境id',
	login: () => {
		history.pushState({}, '企业工作台', '/adminportal')
	}
});
```

## 登录认证
### auth.signIn(params: Object)
登录。目前只支持web，支持用户名密码登录

#### 入参 Object 属性
| 字段 | 必填 | 类型 | 说明 |
| ------ | ------ | ------ | ------ |
| username | 是 | string |  用户手机号，邮箱或自定义用户名 |
| password | 否 | string | 用户密码 ，password 与 verification_token 必须任选其一 |


#### 示例
```javascript
// 1、初始化工作台
import { app, auth } from '@cloudbase/weda-client';
app.init({
	type: 'portal',
	isProd: true,
	envId: '你的环境id',
	login: () => {
		history.pushState({}, '企业工作台', '/adminportal')
	}
});

// 2、调用登录
await auth.signIn({
	username: ‘用户名’,
	password: '密码'
});
```
### auth.onLoginStateChanged((param: Object) => {})
目前只支持web。
如果已登录，则回调参数是UserInfo，否则是null
#### 回调参数 Object 属性
| 属性     | 类型     | 说明     |
| -------- | --------- | -------- |
| userInfo | Object | 用户信息，如果未登录，返回null。已登录，见下面解释 |
| appInfo |  Array<AppInfo>  | 如果未登录，返回null。已登录，见下面解释 |

#### 出参Object属性
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
| name | string | 仅内部用户有name字段，外部用户没有 |
| type | number | 类型。0: 内部用户;1: 外部用户;2: 匿名用户 |
| relatedRoles | array | 已关联角色。见下面解释 |
| openId | string | 微信openid/企业微信openid。|
| userId | string | 微搭用户id |
#### 出参object.relatedRoles[i]属性
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
|id |string |角色id |
|envId |string |环境ID |
|name |string |角色名称 |
|roleIdentity |string |角色标识 |
#### object.appInfo
数组子项：
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
| appCustomNav | Object | 菜单导航信息 |
| deployUrl | string | 部署地址 |
| id | string | 应用id |
| name | string | 应用名 |

#### object.appInfo.appCustomNav
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
| isMultiTerminal | boolean | 是否是双端菜单 |
| menuData | Array<CustomMenu> | pc端菜单 |
| mobileMenuData | Array<CustomMenu> | 移动端菜单 |
| navigationStyle | string | 导航样式 |

#### object.appInfo.appCustomNav.menuData[i]、object.appInfo.appCustomNav.mobileMenuData[i]
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
| Key | string | 菜单key |
| title | string | 菜单标题 |
| type | string | 菜单类型 |
| path | string | 菜单路径 |
| iconUrl | string | 图标地址 |
| children | string | Array<CustomMenu> |
| linkTargetBlank | boolean | 是否新打开页面 |
| level | number | 菜单登记 |

#### 示例
```javascript
// 1、初始化工作台
import { app, auth } from '@cloudbase/weda-client';
app.init({
	type: 'portal',
	isProd: true,
	envId: '你的环境id',
	login: () => {
		history.pushState({}, '企业工作台', '/adminportal')
	}
});

// 2、调用登录
auth.onLoginStateChanged((res) => {
	console.log('监听 onLoginStateChanged res', res);
});
```

### auth.signOut()
登出。目前仅支持web
#### 示例
```javascript
import { app, auth } from '@cloudbase/weda-client';
// 1、初始化工作台
app.init({
	type: 'portal',
	isProd: true,
	envId: '你的环境id',
	login: () => {
		history.pushState({}, '企业工作台', '/adminportal')
	}
});

// 2、调用登录
await auth.signIn({
	username: ‘用户名’,
	password: '密码'
});

// 4、登出。登出是异步，建议await
await auth.signOut();
```

### auth.getAccessToken(): Object
web和小程序都支持。返回accessToken字符串
#### 出参Object属性
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
| accessToken | string | accessToken字符串 |
#### 示例
```javascript
import { app, auth } from '@cloudbase/weda-client';
// 1、初始化工作台
app.init({
	type: 'portal',
	isProd: true,
	envId: '你的环境id',
	login: () => {
		history.pushState({}, '企业工作台', '/adminportal')
	}
});

// 2、调用登录
await auth.signIn({
	username: ‘用户名’,
	password: '密码'
});

// 3、获取accessToken
const res = await auth.getAccessToken();
console.log('getAccessToken res', res);  // { "accessToken"："eyJhbGciOiJSUzI1NiIsImtpZCI6ImRjYWRmM"}
```
### auth.currentUser: Object
web和小程序都支持。
获取用户信息。数据与 `auth.getUserInfo()` 一致。

#### 出参Object属性
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
| name | string | 仅内部用户有name字段，外部用户没有 |
| type | number | 类型。0: 内部用户;1: 外部用户;2: 匿名用户 |
| relatedRoles | array | 已关联角色。见下面解释 |
| openId | string | 微信openid/企业微信openid。|
| userId | string | 微搭用户id |
#### 出参object.relatedRoles[i]属性
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
|id |string |角色id |
|envId |string |环境ID |
|name |string |角色名称 |
|roleIdentity |string |角色标识 |
	
#### 示例
```javascript
// 1、初始化工作台
import { app, auth } from '@cloudbase/weda-client';
app.init({
	type: 'portal',
	isProd: true,
	envId: '你的环境id',
	login: () => {
		history.pushState({}, '企业工作台', '/adminportal')
	}
});

// 2、调用登录
await auth.signIn({
	username: ‘用户名’,
	password: '密码'
});
	
// 3、获取用户信息
const res = await auth.currentUser;
console.log('currentUser res', res);
```
	
### auth.getUserInfo(): Object
web和小程序都支持。获取用户信息。
数据与 `auth.currentUser` 一致。区分内部用户和外部用户，两者信息返回如下。

#### 出参Object属性
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
| name | string | 仅内部用户有name字段，外部用户没有 |
| type | number | 类型。0: 内部用户;1: 外部用户;2: 匿名用户 |
| relatedRoles | array | 已关联角色。见下面解释 |
| openId | string | 微信openid/企业微信openid。|
| userId | string | 微搭用户id |
#### 出参object.relatedRoles[i]属性
| 属性 | 类型 | 说明 |
| ------ | ------ | ------ |
|id |string |角色id |
|envId |string |环境ID |
|name |string |角色名称 |
|roleIdentity |string |角色标识 |

#### 示例
```javascript
// 1、初始化工作台
import { app, auth } from '@cloudbase/weda-client';
app.init({
	type: 'portal',
	isProd: true,
	envId: '你的环境id',
	login: () => {
		history.pushState({}, '企业工作台', '/adminportal')
	}
});

// 2、调用登录
await auth.signIn({
	username: ‘用户名’,
	password: '密码'
});
	
// 3、获取用户信息
const res = await auth.getUserInfo();
console.log('getUserInfo res', res);
```
	
	