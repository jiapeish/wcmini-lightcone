const fs = require('fs')
const path = require('path')

const cloudSdkPath = path.join(__dirname, '../dist/miniprogram/index.js')

// 非私有化小程序中去除对 @cloudbase/js-sdk/* 的引用, 避免增加打包体积
function fixWx() {
  const content = fs.readFileSync(cloudSdkPath, 'utf8')
  const newContent = content.replace(/require\((['"])@cloudbase\/js-sdk\/.*?\1\)/g, '{}')
  if (content !== newContent) {
    fs.writeFileSync(cloudSdkPath, newContent, 'utf8')
  }
}
module.exports = fixWx
