/** lerna 发版时会调用该脚本 */
const path = require('path');
const fs = require('fs');

/**
 * 更新cloud sdk dist 产物中的版本信息
 */
function updateCloudSdkDistVersion() {
  const cloudSdkPath = path.join(__dirname, '..');
  const pkg = require(path.join(cloudSdkPath, 'package.json'));
  const updateVersion = function (filePath, version) {
    const content = fs.readFileSync(filePath, 'utf8');
    fs.writeFileSync(filePath, content.replace('process.env.CLOUD_SDK_VERSION', `"${version}"`), 'utf8');
  };
  const sdkDistPath = path.join(cloudSdkPath, 'dist');
  const sdkEsmPath = path.join(cloudSdkPath, 'esm');
  const paths = [path.join(sdkDistPath, 'cloud-api/config.js'), path.join(sdkEsmPath, 'cloud-api/config.js')];
  paths.forEach((f) => updateVersion(f, pkg.version));
}

updateCloudSdkDistVersion();
